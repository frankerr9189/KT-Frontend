{"ast":null,"code":"import _defineProperty from\"/Users/KerrFamily/Desktop/FoodApp/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _slicedToArray from\"/Users/KerrFamily/Desktop/FoodApp/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _objectSpread from\"/Users/KerrFamily/Desktop/FoodApp/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _taggedTemplateLiteral from\"/Users/KerrFamily/Desktop/FoodApp/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";function _templateObject10(){var data=_taggedTemplateLiteral([\"\\n    height: 400px;\\n    width: 500px;\\n    z-index: 10;\\nbox-shadow: 4px 0px 5px 4px grey;\\ndisplay: flex;\\nflex-direction: column;\\n\"]);_templateObject10=function _templateObject10(){return data;};return data;}function _templateObject9(){var data=_taggedTemplateLiteral([\"\\n    height: 600px;\\n    width: 600px;\\n    z-index: 10;\\nbox-shadow: 4px 0px 5px 4px grey;\\ndisplay: flex;\\nflex-direction: column;\\n\"]);_templateObject9=function _templateObject9(){return data;};return data;}function _templateObject8(){var data=_taggedTemplateLiteral([\"\\n    color: gray;\\n    font-size: 10px;\\n\"]);_templateObject8=function _templateObject8(){return data;};return data;}function _templateObject7(){var data=_taggedTemplateLiteral([\"\\n    font-size: 25px;\\n    padding: 5px 20px;\\n    \\n\"]);_templateObject7=function _templateObject7(){return data;};return data;}function _templateObject6(){var data=_taggedTemplateLiteral([\"\\nmin-height: 50px;\\nmargin-bottom: 20px;\\nbackground-image: url(\\\"img/shark.jpeg\\\");\\nbackground-position: center;\\nbackground-size: cover;\\n\"]);_templateObject6=function _templateObject6(){return data;};return data;}function _templateObject5(){var data=_taggedTemplateLiteral([\"\\n    padding: 10px 0px;\\n    display: grid;\\n    grid-template-columns: 20px 150px 20px 60px;\\n    justify-content: space-between;\\n\"]);_templateObject5=function _templateObject5(){return data;};return data;}function _templateObject4(){var data=_taggedTemplateLiteral([\"\\n    padding: 10px 0px;\\n    border-bottom: 1px solid grey;\\n    \",\"\\n\"]);_templateObject4=function _templateObject4(){return data;};return data;}function _templateObject3(){var data=_taggedTemplateLiteral([\"\\npadding: 20px;\\nheight: 100%\\n\"]);_templateObject3=function _templateObject3(){return data;};return data;}function _templateObject2(){var data=_taggedTemplateLiteral([\"\\ntop: 300px;\\nwidth: 600px;\\nbackground-color: white;\\nheight: 600px;\\nz-index: 10;\\nbox-shadow: 4px 0px 5px 4px grey;\\ndisplay: flex;\\nflex-direction: column;\\n\"]);_templateObject2=function _templateObject2(){return data;};return data;}function _templateObject(){var data=_taggedTemplateLiteral([\"\\ndisplay: grid;\\nwidth: 1000px;\\ngrid-template-columns: 1fr 1fr 1fr;\\ngap: 20px;\\npadding-bottom: 40px;\\n\"]);_templateObject=function _templateObject(){return data;};return data;}import React,{useState,useEffect}from'react';import styled from'styled-components';import{formatPrice}from\"../Data/FoodData\";import{API}from\"../config\";import{isAuthenticated}from'../auth';import{useOpenFood}from\"../Hooks/useOpenFood\";import{useOrders}from\"../Hooks/useOrders\";import{useTitle}from\"../Hooks/useTitle\";import{DialogContent}from\"../FoodDialog/FoodDialog\";import{FoodLabel}from\"../Menu/FoodGrid\";import{getCart,emptyCart}from\"../Cart/carthelper\";import{getBraintreeClientToken,processPayment,createOrder}from\"../admin/adminApi\";import DropIn from'braintree-web-drop-in-react';import{getPrice}from\"../FoodDialog/FoodDialog\";export var FoodGrid=styled.div(_templateObject());var CartStyled=styled.div(_templateObject2());var CartContent=styled(DialogContent)(_templateObject3());var CartContainer=styled.div(_templateObject4(),function(_ref){var editable=_ref.editable;return editable?\"\\n&:hover {\\n    cursor: pointer;\\n    background-color: #e7e7e7;\\n}\\n\":\"\\n    pointer-events: none;\\n    \";});var CartItem=styled.div(_templateObject5());export var CartBanner=styled.div(_templateObject6());export var CartBannerName=styled(FoodLabel)(_templateObject7());var DetailItem=styled.div(_templateObject8());var PaymentStyled=styled.div(_templateObject9());var ShippingBox=styled.div(_templateObject10());export function CheckoutStyled(){var openFood=useOpenFood();var orders=useOrders();useTitle(_objectSpread(_objectSpread({},openFood),orders));var _useState=useState([]),_useState2=_slicedToArray(_useState,2),items=_useState2[0],setItems=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),run=_useState4[0],setRun=_useState4[1];var subtotal=items.reduce(function(total,items){return total+getPrice(items);},0);var displaySubtotal=subtotal.toFixed(2);var tax=subtotal*0.07;var displayTax=tax.toFixed(2);var processingFeeN=(tax+subtotal)*0.05;var displayProcessingFee=processingFeeN.toFixed(2);var total=subtotal+tax+processingFeeN;var displayTotal=total.toFixed(2);var _useState5=useState({success:false,clientToken:null,error:'',instance:{},user:\"\",orderItems:\"\",ShipName:\"\",ShipEmail:\"\",ShipAddress:\"\",ShipCity:\"\",ShipState:\"\",ShipZip:\"\",method:\"\",subTotal:\"\",taxPrice:\"\",processingFee:\"\",totalPrice:\"\"}),_useState6=_slicedToArray(_useState5,2),values=_useState6[0],setValues=_useState6[1];var success=values.success,orderItems=values.orderItems,ShipName=values.ShipName,ShipEmail=values.ShipEmail,ShipAddress=values.ShipAddress,ShipCity=values.ShipCity,ShipState=values.ShipState,ShipZip=values.ShipZip,method=values.method,subTotal=values.subTotal,processingFee=values.processingFee,taxPrice=values.taxPrice,totalPrice=values.totalPrice;useEffect(function(){setItems(getCart());},[run]);var showItems=function showItems(items){return/*#__PURE__*/React.createElement(\"div\",{onBlur:function onBlur(){return setValues(_objectSpread(_objectSpread({},values),{},{error:\"\"}));}},/*#__PURE__*/React.createElement(\"hr\",null),items.map(function(product,i){return/*#__PURE__*/React.createElement(DetailItem,{key:i,items:product,setRun:setRun,run:run},product.name,\" \",\" Qty: \",\" \",product.quantity,\" \",\" \",\" \",product.toppings.filter(function(t){return t.checked;}).map(function(topping){return topping.name;}).join(\", \"),\" $\",getPrice(product).toFixed(2));}));};var userId=isAuthenticated()&&isAuthenticated().user._id;var token=isAuthenticated()&&isAuthenticated().token;var getToken=function getToken(userId,token){getBraintreeClientToken(userId,token).then(function(values){if(values.error){setValues(_objectSpread(_objectSpread({},values),{},{error:values.error}));}else{setValues({clientToken:values.clientToken});}});};useEffect(function(){getToken(userId,token);},[]);var deliveryMethod=values.method;var buy=function buy(){// send nonce to your server\n//nonce= values.instance.requestPaymentMethod()\nvar nonce;var getNonce=values.instance.requestPaymentMethod().then(function(values){// console.log(values)\nnonce=values.nonce;//once you have nonce (card type, card number) send nonce as \"paymentMethodNonce\"\n//and also total to be charged\n//console.log('send nonce and total to process: ', nonce, total)\nvar paymentData={paymentMethodNonce:nonce,amount:displayTotal};processPayment(userId,token,paymentData).then(function(response){console.log(values);//empty cart & create order\nvar createOrderData={orderItems:items,ShipName:ShipName,ShipEmail:ShipEmail,ShipAddress:ShipAddress,ShipCity:ShipCity,ShipState:ShipState,ShipZip:ShipZip,method:deliveryMethod,subTotal:displaySubtotal,taxPrice:displayTax,processingFee:displayProcessingFee,totalPrice:displayTotal};createOrder(userId,token,createOrderData).then(function(response){emptyCart(function(){console.log('payment success and empty cart');setValues({success:true});localStorage.clear();});}).catch(function(error){return console.log(error);});});}).catch(function(error){console.log('drop in error: ',error);setValues(_objectSpread(_objectSpread({},values),{},{error:error.message}));//empty cart\n//create order\n});};var showError=function showError(error){return/*#__PURE__*/React.createElement(\"div\",{style:{display:values.error?'':'none'}},error);};var showSuccess=function showSuccess(success){return/*#__PURE__*/React.createElement(\"div\",{style:{display:success?'':'none'}},/*#__PURE__*/React.createElement(\"h2\",null,\"Thanks! Your payment was successful!\"));};var showDropIn=function showDropIn(){return/*#__PURE__*/React.createElement(\"div\",{onBlur:function onBlur(){return setValues(_objectSpread(_objectSpread({},values),{},{error:''}));}},values.clientToken!==null&&items.length>0?/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(DropIn,{options:{authorization:values.clientToken,paypal:{flow:'vault'}},onInstance:function onInstance(instance){return values.instance=instance;}}),/*#__PURE__*/React.createElement(\"button\",{onClick:buy,className:\"btn-block\"},\"Pay\")):null);};var handleChange=function handleChange(name){return function(event){var value=name==='name'?event.target.files[0]:event.target.value;setValues(_objectSpread(_objectSpread({},values),{},_defineProperty({},name,value)));};};var clickSubmit=function clickSubmit(event){event.preventDefault();setValues(_objectSpread({},values));console.log(values);};var handleMethod=function handleMethod(event){setValues(_objectSpread(_objectSpread({},values),{},{method:event.target.value}));};var shippingMethod=function shippingMethod(){return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"label\",null,\"Method Type:\"),/*#__PURE__*/React.createElement(\"select\",{className:\"form-control\",onChange:handleMethod},/*#__PURE__*/React.createElement(\"option\",null,\"Select Method\"),/*#__PURE__*/React.createElement(\"option\",null,\"Pick Up\"),/*#__PURE__*/React.createElement(\"option\",null,\"Delivery\")));};var shippingForm=function shippingForm(){return/*#__PURE__*/React.createElement(\"form\",{className:\"mb-3\"},/*#__PURE__*/React.createElement(\"div\",{className:\"form-group\"},/*#__PURE__*/React.createElement(\"label\",{className:\"text-muted\"},\"Name: \"),/*#__PURE__*/React.createElement(\"input\",{onChange:handleChange('ShipName'),type:\"text\",className:\"form-control\",value:ShipName||\"\"})),/*#__PURE__*/React.createElement(\"div\",{className:\"form-group\"},/*#__PURE__*/React.createElement(\"label\",{className:\"text-muted\"},\"Email: \"),/*#__PURE__*/React.createElement(\"input\",{onChange:handleChange('ShipEmail'),type:\"text\",className:\"form-control\",value:ShipEmail||\"\"})),/*#__PURE__*/React.createElement(\"div\",{className:\"form-group\"},/*#__PURE__*/React.createElement(\"label\",{className:\"text-muted\"},\"Address: \"),/*#__PURE__*/React.createElement(\"input\",{onChange:handleChange('ShipAddress'),type:\"text\",className:\"form-control\",value:ShipAddress||\"\"})),/*#__PURE__*/React.createElement(\"div\",{className:\"form-group\"},/*#__PURE__*/React.createElement(\"label\",{className:\"text-muted\"},\"City: \"),/*#__PURE__*/React.createElement(\"input\",{onChange:handleChange('ShipCity'),type:\"text\",className:\"form-control\",value:ShipCity||\"\"})),/*#__PURE__*/React.createElement(\"div\",{className:\"form-group\"},/*#__PURE__*/React.createElement(\"label\",{className:\"text-muted\"},\"State: \"),/*#__PURE__*/React.createElement(\"input\",{onChange:handleChange('ShipState'),type:\"text\",className:\"form-control\",value:ShipState||\"\"})),/*#__PURE__*/React.createElement(\"div\",{className:\"form-group\"},/*#__PURE__*/React.createElement(\"label\",{className:\"text-muted\"},\"Zip: \"),/*#__PURE__*/React.createElement(\"input\",{onChange:handleChange('ShipZip'),type:\"text\",className:\"form-control\",value:ShipZip||\"\"})));};return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(FoodGrid,null,/*#__PURE__*/React.createElement(CartStyled,null,/*#__PURE__*/React.createElement(CartContainer,null,/*#__PURE__*/React.createElement(CartBanner,{img:\"\".concat(API,\"/product/photo/shark.jpeg\")},/*#__PURE__*/React.createElement(CartBannerName,null,\"Summary, your cart has \",\"\".concat(items.length),\" items.\")),/*#__PURE__*/React.createElement(CartContent,null,showSuccess(success),showItems(items),/*#__PURE__*/React.createElement(DetailItem,null,\"Sub-Total: \",formatPrice(subtotal),\" \"),/*#__PURE__*/React.createElement(DetailItem,null,\"Tax: \",formatPrice(tax),\" \"),/*#__PURE__*/React.createElement(DetailItem,null,\"Processing Fee: \",formatPrice(processingFeeN),\" \"),/*#__PURE__*/React.createElement(DetailItem,null,\"Total: \",formatPrice(total),\" \")))),/*#__PURE__*/React.createElement(PaymentStyled,null,/*#__PURE__*/React.createElement(CartBanner,null,/*#__PURE__*/React.createElement(CartBannerName,null,\"Delivery Address\")),shippingMethod(),shippingForm(),/*#__PURE__*/React.createElement(CartBanner,null,/*#__PURE__*/React.createElement(CartBannerName,null,\"Payment Method\")),showSuccess(values.success),showError(values.error),showDropIn())));}","map":{"version":3,"sources":["/Users/KerrFamily/Desktop/FoodApp/src/user/CheckoutStyled.js"],"names":["React","useState","useEffect","styled","formatPrice","API","isAuthenticated","useOpenFood","useOrders","useTitle","DialogContent","FoodLabel","getCart","emptyCart","getBraintreeClientToken","processPayment","createOrder","DropIn","getPrice","FoodGrid","div","CartStyled","CartContent","CartContainer","editable","CartItem","CartBanner","CartBannerName","DetailItem","PaymentStyled","ShippingBox","CheckoutStyled","openFood","orders","items","setItems","run","setRun","subtotal","reduce","total","displaySubtotal","toFixed","tax","displayTax","processingFeeN","displayProcessingFee","displayTotal","success","clientToken","error","instance","user","orderItems","ShipName","ShipEmail","ShipAddress","ShipCity","ShipState","ShipZip","method","subTotal","taxPrice","processingFee","totalPrice","values","setValues","showItems","map","product","i","name","quantity","toppings","filter","t","checked","topping","join","userId","_id","token","getToken","then","deliveryMethod","buy","nonce","getNonce","requestPaymentMethod","paymentData","paymentMethodNonce","amount","response","console","log","createOrderData","localStorage","clear","catch","message","showError","display","showSuccess","showDropIn","length","authorization","paypal","flow","handleChange","event","value","target","files","clickSubmit","preventDefault","handleMethod","shippingMethod","shippingForm"],"mappings":"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","sourcesContent":["import React, {useState, useEffect} from 'react';\nimport styled from 'styled-components';\nimport {formatPrice} from \"../Data/FoodData\";\nimport {API} from \"../config\";\nimport {isAuthenticated} from '../auth';\nimport {useOpenFood} from \"../Hooks/useOpenFood\";\nimport {useOrders} from \"../Hooks/useOrders\";\nimport {useTitle} from \"../Hooks/useTitle\";\nimport {DialogContent} from \"../FoodDialog/FoodDialog\";\nimport {FoodLabel} from \"../Menu/FoodGrid\";\nimport {getCart, emptyCart} from \"../Cart/carthelper\";\nimport {getBraintreeClientToken, processPayment, createOrder} from \"../admin/adminApi\";\nimport DropIn from 'braintree-web-drop-in-react';\nimport {getPrice} from \"../FoodDialog/FoodDialog\";\n\nexport const FoodGrid = styled.div`\ndisplay: grid;\nwidth: 1000px;\ngrid-template-columns: 1fr 1fr 1fr;\ngap: 20px;\npadding-bottom: 40px;\n`;\n\n\nconst CartStyled = styled.div`\ntop: 300px;\nwidth: 600px;\nbackground-color: white;\nheight: 600px;\nz-index: 10;\nbox-shadow: 4px 0px 5px 4px grey;\ndisplay: flex;\nflex-direction: column;\n`;\n\nconst CartContent = styled(DialogContent)`\npadding: 20px;\nheight: 100%\n`;\n\nconst CartContainer = styled.div`\n    padding: 10px 0px;\n    border-bottom: 1px solid grey;\n    ${({editable}) =>\neditable ? `\n&:hover {\n    cursor: pointer;\n    background-color: #e7e7e7;\n}\n`\n    : `\n    pointer-events: none;\n    `}\n`;\n\nconst CartItem = styled.div`\n    padding: 10px 0px;\n    display: grid;\n    grid-template-columns: 20px 150px 20px 60px;\n    justify-content: space-between;\n`;\nexport const CartBanner = styled.div`\nmin-height: 50px;\nmargin-bottom: 20px;\nbackground-image: url(\"img/shark.jpeg\");\nbackground-position: center;\nbackground-size: cover;\n`;\nexport const CartBannerName = styled(FoodLabel)`\n    font-size: 25px;\n    padding: 5px 20px;\n    \n`;\n\nconst DetailItem = styled.div`\n    color: gray;\n    font-size: 10px;\n`\n\nconst PaymentStyled = styled.div`\n    height: 600px;\n    width: 600px;\n    z-index: 10;\nbox-shadow: 4px 0px 5px 4px grey;\ndisplay: flex;\nflex-direction: column;\n`\nconst ShippingBox = styled.div`\n    height: 400px;\n    width: 500px;\n    z-index: 10;\nbox-shadow: 4px 0px 5px 4px grey;\ndisplay: flex;\nflex-direction: column;\n`\n\n\nexport function CheckoutStyled(){ \n    const openFood = useOpenFood();\n    const orders = useOrders();\n    useTitle({...openFood, ...orders});\n    const [items, setItems] = useState([]);\n    const [run, setRun] = useState(false);\n    const subtotal = items.reduce((total, items) => {\n        return total + getPrice(items);\n    }, 0);\n    const displaySubtotal = subtotal.toFixed(2);\n    const tax = subtotal * 0.07;\n    const displayTax = tax.toFixed(2);\n    const processingFeeN = (tax + subtotal) * 0.05;\n    const displayProcessingFee = processingFeeN.toFixed(2);\n    const total = subtotal + tax + processingFeeN;\n    const displayTotal = total.toFixed(2);\n    const [values, setValues] = useState(\n        {\n    success: false,\n    clientToken: null,\n    error: '',\n    instance: {},\n    user: \"\",\n    orderItems: \"\",\n    ShipName: \"\",\n    ShipEmail: \"\",\n    ShipAddress: \"\",\n    ShipCity: \"\",\n    ShipState: \"\",\n    ShipZip: \"\",\n    method: \"\",\n    subTotal: \"\",\n    taxPrice: \"\",\n    processingFee:\"\",\n    totalPrice: \"\",\n        }\n    );\n\n    const {success, orderItems, ShipName, ShipEmail, ShipAddress, ShipCity, ShipState, ShipZip, method, subTotal, processingFee, taxPrice, totalPrice} = values;\n\n    useEffect(()=> {\n        setItems(getCart());\n    }, [run]);\n    \n    const showItems = items => {\n        return(\n            <div onBlur={()=> setValues({...values, error:\"\"})}>\n                <hr/>\n                {items.map((product, i)=> (\n                <DetailItem \n                key ={i} \n                items={product}\n                setRun={setRun}\n                run={run}\n                >{product.name} {\" Qty: \"} {product.quantity} {\" \"} {product.toppings\n                    .filter(t => t.checked)\n                    .map(topping => topping.name)\n                    .join(\", \")\n                    }{\" $\"}{getPrice(product).toFixed(2)}</DetailItem>\n                ))\n                }\n            </div>\n        );\n    };\n\n    const userId = isAuthenticated() && isAuthenticated().user._id;\n    const token = isAuthenticated() && isAuthenticated().token;\n\n    const getToken = (userId, token) => {\n        getBraintreeClientToken(userId, token).then(values => {\n            if(values.error) {\n                setValues({...values, error: values.error})\n            }else{\n                setValues({clientToken: values.clientToken})\n            }\n        })\n    };\n\n    useEffect(()=>{\n        getToken(userId, token)\n    }, []);\n\n    let deliveryMethod = values.method;\n\n\n    const buy = () => {\n        // send nonce to your server\n        //nonce= values.instance.requestPaymentMethod()\n        let nonce;\n        let getNonce = values.instance\n        .requestPaymentMethod()\n        .then( values => {\n           // console.log(values)\n            nonce = values.nonce;\n            //once you have nonce (card type, card number) send nonce as \"paymentMethodNonce\"\n            //and also total to be charged\n            //console.log('send nonce and total to process: ', nonce, total)\n        const paymentData ={\n            paymentMethodNonce: nonce,\n            amount: displayTotal\n        }\n\n        processPayment(userId, token, paymentData)\n        .then(response=> {\n            console.log(values);\n                //empty cart & create order\n\n               const createOrderData = {\n                    orderItems: items,\n                    ShipName: ShipName,\n                    ShipEmail: ShipEmail,\n                    ShipAddress: ShipAddress,\n                    ShipCity: ShipCity,\n                    ShipState: ShipState,\n                    ShipZip: ShipZip,\n                    method: deliveryMethod,\n                    subTotal: displaySubtotal,\n                    taxPrice: displayTax,\n                    processingFee: displayProcessingFee,\n                    totalPrice: displayTotal\n                };\n\n                createOrder(userId, token, createOrderData)\n                .then(response => {\n                    emptyCart(() => {\n                        console.log('payment success and empty cart');\n                        setValues({\n                            success: true\n                        });\n                        localStorage.clear();\n                    });\n                })\n                .catch(error => console.log(error));\n        });\n    })\n    .catch(error => {\n            console.log('drop in error: ', error)\n            setValues({...values, error: error.message});\n            //empty cart\n            //create order\n        });\n    };\n\n    const showError = error => (\n        <div style={{ display: values.error ? '' : 'none' }}>\n            {error}\n        </div>\n    );\n\n    const showSuccess = success => (\n        <div style={{ display: success ? '' : 'none' }}>\n            <h2>Thanks! Your payment was successful!</h2>\n        </div>\n    );\n\n    const showDropIn= () => (\n        <div onBlur={() => setValues({ ...values, error: '' })}>\n            \n            {values.clientToken !== null && items.length>0 ? (\n                <div>\n                    <DropIn\n                        options={{\n                            authorization: values.clientToken,\n                            paypal: {\n                                flow: 'vault'\n                            }\n                        }}\n                        onInstance={instance => (values.instance = instance)}\n                    />\n                    <button onClick={buy} className=\"btn-block\">\n                        Pay\n                    </button>\n                </div>\n            ) : null}\n        </div>\n    );\n\n    const handleChange = name => event => {\n        const value = name === 'name' ? event.target.files[0]: event.target.value;\n        setValues({...values, [name]: value});\n    };\n\n    const clickSubmit = event => {\n        event.preventDefault();\n        setValues({...values});\n        console.log((values));\n     };\n\n     const handleMethod = event => {\n        setValues({...values, method: event.target.value });\n    };\n\n\n    const shippingMethod = () => (\n        <div>\n                        <label>Method Type:</label>\n                        <select \n            className=\"form-control\" onChange={handleMethod}\n           >\n                <option>Select Method</option>\n                <option>Pick Up</option>\n                <option>Delivery</option>\n            </select>\n       </div>\n    )\n\n    const shippingForm = () => (\n        <form className=\"mb-3\">\n            <div className=\"form-group\">\n                <label className=\"text-muted\">Name: </label>\n                <input onChange={handleChange('ShipName')} type=\"text\" className=\"form-control\" value={ShipName || \"\"}/>\n            </div>\n            <div className=\"form-group\">\n                <label className=\"text-muted\">Email: </label>\n                <input onChange={handleChange('ShipEmail')} type=\"text\" className=\"form-control\" value={ShipEmail|| \"\"}/>\n            </div>\n            <div className=\"form-group\">\n                <label className=\"text-muted\">Address: </label>\n                <input onChange={handleChange('ShipAddress')} type=\"text\" className=\"form-control\" value={ShipAddress||\"\"}/>\n            </div>\n            <div className=\"form-group\">\n                <label className=\"text-muted\">City: </label>\n                <input onChange={handleChange('ShipCity')} type=\"text\" className=\"form-control\" value={ShipCity||\"\"}/>\n            </div>\n            <div className=\"form-group\">\n                <label className=\"text-muted\">State: </label>\n                <input onChange={handleChange('ShipState')} type=\"text\" className=\"form-control\" value={ShipState||\"\"}/>\n            </div>\n            <div className=\"form-group\">\n                <label className=\"text-muted\">Zip: </label>\n                <input onChange={handleChange('ShipZip')} type=\"text\" className=\"form-control\" value={ShipZip||\"\"}/>\n            </div>\n            {/* <button className=\"btn btn-outline-primary\">Shipping</button> */}\n        </form>\n    );\n\n    return (\n        <>\n        <FoodGrid> \n        <CartStyled>\n    <CartContainer>\n    <CartBanner img={`${API}/product/photo/shark.jpeg`}>\n        <CartBannerName>Summary, your cart has {`${items.length}`} items.</CartBannerName>\n    </CartBanner>\n        <CartContent>\n            {showSuccess(success)}\n            {showItems(items)}\n            <DetailItem>Sub-Total: {formatPrice(subtotal)} </DetailItem>\n            <DetailItem>Tax: {formatPrice(tax)} </DetailItem>           \n            <DetailItem>Processing Fee: {formatPrice(processingFeeN)} </DetailItem>\n            <DetailItem>Total: {formatPrice(total)} </DetailItem>\n        </CartContent>\n    </CartContainer>\n    </CartStyled>\n\n    <PaymentStyled>\n    <CartBanner>\n    <CartBannerName>Delivery Address</CartBannerName>\n    </CartBanner>\n        {shippingMethod()}\n        {shippingForm()}\n    <CartBanner>\n            <CartBannerName>Payment Method</CartBannerName></CartBanner>\n            {showSuccess(values.success)}\n            {showError(values.error)}\n            {showDropIn()}\n    </PaymentStyled>\n    </FoodGrid>\n    </>\n    );\n}"]},"metadata":{},"sourceType":"module"}